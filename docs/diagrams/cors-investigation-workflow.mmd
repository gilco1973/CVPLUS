graph TD
    A[Start CORS Investigation] --> B[Phase 1: Discovery & Assessment]
    
    B --> B1[Function Inventory & CORS Audit]
    B --> B2[Error Analysis & Origin Mapping]
    B --> B3[Frontend Integration Analysis]
    
    B1 --> C[Phase 2: Root Cause Analysis]
    B2 --> C
    B3 --> C
    
    C --> C1[CORS Implementation Deep Dive]
    C --> C2[Common CORS Issue Patterns]
    C --> C3[Environment-Specific Issues]
    
    C1 --> D[Phase 3: Solution Design]
    C2 --> D
    C3 --> D
    
    D --> D1[Unified CORS Strategy]
    D --> D2[Implementation Architecture]
    D --> D3[Configuration Strategy]
    
    D1 --> E[Phase 4: Implementation & Testing]
    D2 --> E
    D3 --> E
    
    E --> E1[Core CORS Module Implementation]
    E --> E2[Function-by-Function Updates]
    E --> E3[Local Testing Environment]
    
    E1 --> F[Phase 5: Firebase Testing & Deployment]
    E2 --> F
    E3 --> F
    
    F --> F1[Emulator Testing]
    F --> F2[Staging Deployment]
    F --> F3[Production Rollout]
    
    F1 --> G[Phase 6: Validation & Monitoring]
    F2 --> G
    F3 --> G
    
    G --> G1[Production Validation]
    G --> G2[Monitoring Setup]
    G --> G3[Documentation]
    
    G1 --> H{Zero CORS Errors?}
    G2 --> H
    G3 --> H
    
    H -->|Yes| I[Success: Complete]
    H -->|No| J[Rollback & Investigate]
    
    J --> K[Analyze Remaining Issues]
    K --> E[Return to Implementation]
    
    I --> L[Ongoing Monitoring]
    L --> M[Maintenance & Updates]
    
    %% Styling
    classDef phaseBox fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
    classDef taskBox fill:#f3e5f5,stroke:#7b1fa2,stroke-width:1px
    classDef decisionBox fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    classDef successBox fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef rollbackBox fill:#ffebee,stroke:#c62828,stroke-width:2px
    
    class B,C,D,E,F,G phaseBox
    class B1,B2,B3,C1,C2,C3,D1,D2,D3,E1,E2,E3,F1,F2,F3,G1,G2,G3 taskBox
    class H decisionBox
    class I,L,M successBox
    class J,K rollbackBox