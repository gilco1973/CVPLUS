graph TB
    %% Current State - Root Repository Code
    subgraph "CURRENT STATE - CRITICAL ISSUES"
        subgraph "Root Repository (VIOLATIONS)"
            RF["/functions/src/<br/>50+ Files<br/>ğŸš¨ MISPLACED"]
            RFE["/frontend/src/<br/>50+ Files<br/>ğŸš¨ MISPLACED"]
            CVP["/packages/cv-processing/<br/>ğŸš¨ NOT A SUBMODULE"]
        end
    end

    %% Target State - Proper Submodules
    subgraph "TARGET STATE - PROPER MODULAR ARCHITECTURE"
        subgraph "Git Submodules (packages/)"
            CVS["ğŸ“¦ cv-processing<br/>ğŸ”„ CONVERT TO SUBMODULE<br/>CV Processing Logic"]
            PREM["ğŸ“¦ premium<br/>âœ… Submodule<br/>Subscription & Billing"]
            ANA["ğŸ“¦ analytics<br/>âœ… Submodule<br/>Revenue & ML Analytics"]
            AUTH["ğŸ“¦ auth<br/>âœ… Submodule<br/>Authentication & Security"]
            REC["ğŸ“¦ recommendations<br/>âœ… Submodule<br/>AI Recommendations"]
            ADM["ğŸ“¦ admin<br/>âœ… Submodule<br/>Admin Dashboard"]
            CORE["ğŸ“¦ core<br/>âœ… Submodule<br/>Shared Types & Utils"]
            MUL["ğŸ“¦ multimedia<br/>âœ… Submodule<br/>Media Processing"]
            I18N["ğŸ“¦ i18n<br/>âœ… Submodule<br/>Internationalization"]
            PUB["ğŸ“¦ public-profiles<br/>âœ… Submodule<br/>Public Profiles"]
        end
    end

    %% Migration Flow
    subgraph "MIGRATION PHASES"
        subgraph "Phase 1: CRITICAL (URGENT)"
            P1A["ğŸš¨ Convert cv-processing<br/>to Git Submodule<br/>HIGH RISK"]
            P1B["ğŸ”„ Premium Functions Migration<br/>17 Files â†’ premium/<br/>HIGH RISK"]
        end
        
        subgraph "Phase 2: HIGH VALUE"
            P2A["ğŸ“Š Analytics Migration<br/>12 Files â†’ analytics/<br/>MEDIUM RISK"]
            P2B["ğŸ” Auth & Security Migration<br/>8 Files â†’ auth/<br/>MEDIUM RISK"]
        end
        
        subgraph "Phase 3: USER FEATURES"
            P3A["ğŸ¯ Recommendations Complete<br/>15 Files â†’ recommendations/<br/>LOW RISK"]
            P3B["âš™ï¸ Admin Components<br/>5 Files â†’ admin/<br/>LOW RISK"]
        end
        
        subgraph "Phase 4: CLEANUP"
            P4A["ğŸ”§ External Adapters<br/>3 Files â†’ appropriate modules<br/>LOW RISK"]
            P4B["âš¡ Cache Services Distribution<br/>10 Files â†’ relevant modules<br/>LOW RISK"]
        end
    end

    %% Detailed File Mapping
    subgraph "DETAILED FILE MIGRATION MAPPING"
        subgraph "Premium Files (17 files)"
            PF1["/functions/src/functions/premium/<br/>â€¢ advancedAnalytics.ts<br/>â€¢ dynamicPricing.ts<br/>â€¢ enterpriseManagement.ts<br/>â€¢ getRealtimeUsageStats.ts<br/>â€¢ batchTrackingEvents.ts"]
            PF2["/functions/src/services/premium/<br/>â€¢ pricing/ (3 services)<br/>â€¢ analytics/ (2 services)<br/>â€¢ enterprise/ (3 services)<br/>â€¢ featureRegistry.ts"]
            PF3["/frontend/src/components/premium/<br/>â€¢ PremiumDashboard.tsx<br/>â€¢ EnhancedFeatureGate.tsx<br/>â€¢ /services/premium/ (4 services)"]
        end
        
        subgraph "Analytics Files (12 files)"
            AF1["/functions/src/functions/analytics/<br/>â€¢ getRevenueMetrics.ts"]
            AF2["/functions/src/functions/ml/<br/>â€¢ predictChurn.ts"]
            AF3["/functions/src/services/analytics/<br/>â€¢ cohort-analysis.service.ts<br/>â€¢ revenue-analytics.service.ts"]
            AF4["/functions/src/services/ml/<br/>â€¢ churn-prediction.service.ts"]
        end
        
        subgraph "Auth Files (8 files)"
            AUF1["/functions/src/middleware/<br/>â€¢ authGuard.ts<br/>â€¢ enhancedPremiumGuard.ts<br/>â€¢ security-headers.ts"]
            AUF2["/functions/src/services/security/<br/>â€¢ rate-limit-guard.service.ts<br/>â€¢ security-monitor.service.ts"]
            AUF3["/frontend/src/modules/<br/>â€¢ auth.ts"]
            AUF4["/frontend/src/hooks/<br/>â€¢ useFeatureGate.ts"]
        end
    end

    %% Migration Arrows
    CVP -->|"Convert to Submodule<br/>Git History Preservation"| CVS
    RF -->|"Business Logic Extraction"| PREM
    RF -->|"Analytics Functions"| ANA
    RF -->|"Security Middleware"| AUTH
    RFE -->|"Premium Components"| PREM
    RFE -->|"Recommendation UI"| REC
    RFE -->|"Auth Components"| AUTH

    %% Phase Flow
    P1A --> P1B
    P1B --> P2A
    P2A --> P2B
    P2B --> P3A
    P3A --> P3B
    P3B --> P4A
    P4A --> P4B

    %% File Mapping Arrows
    PF1 -->|"Backend Functions"| PREM
    PF2 -->|"Services Layer"| PREM
    PF3 -->|"Frontend Components"| PREM
    AF1 -->|"Revenue Functions"| ANA
    AF2 -->|"ML Functions"| ANA
    AF3 -->|"Analytics Services"| ANA
    AF4 -->|"ML Services"| ANA
    AUF1 -->|"Middleware"| AUTH
    AUF2 -->|"Security Services"| AUTH
    AUF3 -->|"Frontend Auth"| AUTH
    AUF4 -->|"Auth Hooks"| AUTH

    %% Risk Level Styling
    classDef critical fill:#ffcccc,stroke:#ff0000,stroke-width:3px
    classDef high fill:#ffe0cc,stroke:#ff8800,stroke-width:2px
    classDef medium fill:#ffffcc,stroke:#ffaa00,stroke-width:2px
    classDef low fill:#e0ffe0,stroke:#00aa00,stroke-width:1px
    classDef submodule fill:#e6f3ff,stroke:#0066cc,stroke-width:2px

    class RF,RFE,CVP critical
    class P1A,P1B high
    class P2A,P2B medium
    class P3A,P3B,P4A,P4B low
    class CVS,PREM,ANA,AUTH,REC,ADM,CORE,MUL,I18N,PUB submodule

    %% Timeline Information
    subgraph "IMPLEMENTATION TIMELINE"
        T1["Day 1: Phase 1<br/>6-8 hours<br/>CV-Processing + Premium"]
        T2["Day 2: Phase 2<br/>6-8 hours<br/>Analytics + Auth"]
        T3["Day 3: Phase 3<br/>4-6 hours<br/>Recommendations + Admin"]
        T4["Day 4: Phase 4<br/>2-4 hours<br/>Final Cleanup"]
    end

    T1 --> T2 --> T3 --> T4

    %% Success Criteria
    subgraph "SUCCESS CRITERIA"
        SC1["âœ… Zero Build Errors"]
        SC2["âœ… 100% Test Coverage"]
        SC3["âœ… Functional Equivalence"]
        SC4["âœ… Clean Git History"]
        SC5["âœ… Architecture Compliance"]
    end

    %% Dependencies
    subgraph "REQUIRED SUBAGENTS"
        GE["ğŸ”§ git-expert<br/>Submodule Operations"]
        TP["ğŸ“ typescript-pro<br/>Import Path Updates"]
        SA["ğŸ—ï¸ system-architect<br/>Architecture Validation"]
        TCE["ğŸ§ª test-coverage-engineers<br/>Validation Testing"]
    end